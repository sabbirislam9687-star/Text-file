<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Professional Text Editor + Canvas</title>
<style>
:root {
  --primary-color: #4a6fa5;
  --secondary-color: #6b8cbc;
  --dark-bg: #1e1e1e;
  --dark-text: #e0e0e0;
  --light-bg: #f5f5f5;
  --light-text: #333;
  --sidebar-width: 300px;
  --transition-speed: 0.3s;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--light-bg);
  color: var(--light-text);
  transition: background var(--transition-speed), color var(--transition-speed);
}

body.dark-mode {
  background: var(--dark-bg);
  color: var(--dark-text);
}

.container {
  display: flex;
  min-height: 100vh;
}

/* Sidebar Styles */
.sidebar {
  width: var(--sidebar-width);
  background: #fff;
  height: 100vh;
  padding: 15px;
  box-shadow: 2px 0 8px rgba(0,0,0,0.1);
  overflow-y: auto;
  transition: transform var(--transition-speed);
  z-index: 100;
  position: fixed;
  left: 0;
  top: 0;
}

body.dark-mode .sidebar {
  background: #2d2d2d;
  color: var(--dark-text);
}

.sidebar.collapsed {
  transform: translateX(calc(-1 * var(--sidebar-width)));
}

.sidebar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #eee;
}

body.dark-mode .sidebar-header {
  border-bottom-color: #444;
}

.sidebar-title {
  font-size: 1.2rem;
  font-weight: 600;
  margin: 0;
}

.close-btn {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #666;
  padding: 0;
  width: auto;
}

body.dark-mode .close-btn {
  color: #aaa;
}

.sidebar-section {
  margin-bottom: 20px;
}

.section-title {
  font-size: 0.9rem;
  font-weight: 600;
  margin-bottom: 10px;
  color: #666;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

body.dark-mode .section-title {
  color: #aaa;
}

/* Button and Input Styles */
button, select, input[type="number"], input[type="color"] {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  border: 1px solid #ddd;
  border-radius: 6px;
  box-sizing: border-box;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
}

button {
  background: #f8f8f8;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

button:hover {
  background: #eaeaea;
}

button.primary {
  background: var(--primary-color);
  color: white;
  border-color: var(--primary-color);
}

button.primary:hover {
  background: var(--secondary-color);
}

body.dark-mode button {
  background: #3a3a3a;
  color: var(--dark-text);
  border-color: #555;
}

body.dark-mode button:hover {
  background: #4a4a4a;
}

body.dark-mode button.primary {
  background: var(--primary-color);
}

body.dark-mode button.primary:hover {
  background: var(--secondary-color);
}

body.dark-mode select, 
body.dark-mode input[type="number"], 
body.dark-mode input[type="color"] {
  background: #3a3a3a;
  color: var(--dark-text);
  border-color: #555;
}

/* Main Content Styles */
.main-content {
  flex: 1;
  padding: 20px;
  margin-left: var(--sidebar-width);
  transition: margin-left var(--transition-speed);
}

.main-content.expanded {
  margin-left: 0;
}

.menu-toggle {
  font-size: 24px;
  padding: 10px;
  cursor: pointer;
  background: var(--primary-color);
  color: white;
  border: none;
  border-radius: 6px;
  width: auto;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.menu-toggle:hover {
  background: var(--secondary-color);
}

/* Editor Styles */
.editor-container {
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  overflow: hidden;
  margin-bottom: 20px;
}

body.dark-mode .editor-container {
  background: #2d2d2d;
}

#editor {
  width: 100%;
  height: 45vh;
  padding: 20px;
  font-size: 18px;
  border: none;
  outline: none;
  resize: none;
  background: #fff;
  line-height: 1.6;
}

body.dark-mode #editor {
  background: #2d2d2d;
  color: var(--dark-text);
}

/* Canvas Styles */
.canvas-container {
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  overflow: hidden;
  margin-bottom: 20px;
  padding: 10px;
}

body.dark-mode .canvas-container {
  background: #2d2d2d;
}

#canvas {
  width: 100%;
  height: 30vh;
  border: 1px solid #ddd;
  background: #fff;
  border-radius: 6px;
  display: block;
}

body.dark-mode #canvas {
  background: #3a3a3a;
  border-color: #555;
}

/* Status Bar */
.status-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 15px;
  background: #f8f8f8;
  border-top: 1px solid #eee;
  font-size: 14px;
}

body.dark-mode .status-bar {
  background: #3a3a3a;
  border-top-color: #555;
  color: var(--dark-text);
}

#count {
  font-weight: bold;
}

/* Toolbar */
.toolbar {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.toolbar button {
  width: auto;
  flex: 1;
  min-width: 80px;
}

/* Responsive */
@media (max-width: 768px) {
  .sidebar {
    width: 100%;
    transform: translateX(-100%);
  }
  
  .sidebar.collapsed {
    transform: translateX(-100%);
  }
  
  .main-content {
    margin-left: 0;
    padding: 15px;
  }
  
  .toolbar {
    flex-direction: column;
  }
  
  .toolbar button {
    width: 100%;
  }
}

/* Active states */
button.active {
  background: var(--primary-color);
  color: white;
}

body.dark-mode button.active {
  background: var(--primary-color);
}

/* File input styling */
input[type="file"] {
  width: 100%;
  padding: 8px;
  margin-bottom: 10px;
  border: 1px dashed #ccc;
  border-radius: 4px;
  background: #f9f9f9;
}

body.dark-mode input[type="file"] {
  background: #3a3a3a;
  border-color: #555;
  color: var(--dark-text);
}

/* Icon styles */
.icon {
  font-size: 16px;
}
</style>
</head>
<body>

<div class="container">
  <div class="sidebar" id="sideMenu">
    <div class="sidebar-header">
      <h2 class="sidebar-title">‡¶ü‡ßÅ‡¶≤‡¶∏</h2>
      <button class="close-btn" onclick="toggleMenu()">√ó</button>
    </div>
    
    <div class="sidebar-section">
      <h3 class="section-title">‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶®</h3>
      <button class="primary" onclick="newFile()">
        <span class="icon">üìÑ</span> ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶á‡¶≤
      </button>
      <input type="file" id="openFile" onchange="openFile(event)">
      <button onclick="saveFile()">
        <span class="icon">üíæ</span> ‡¶∏‡ßá‡¶≠
      </button>
      <button onclick="downloadPDF()">
        <span class="icon">üìã</span> PDF ‡¶¨‡¶æ‡¶®‡¶æ‡¶ì
      </button>
    </div>
    
    <div class="sidebar-section">
      <h3 class="section-title">‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤</h3>
      <label>‡¶´‡¶®‡ßç‡¶ü:</label>
      <select id="fontSelect" onchange="updateFont()">
        <option value="Arial">Arial</option>
        <option value="Noto Sans Bengali">Noto Sans Bengali</option>
        <option value="SolaimanLipi">SolaimanLipi</option>
        <option value="Times New Roman">Times New Roman</option>
      </select>

      <label>‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú:</label>
      <input type="number" id="fontSize" value="18" min="8" max="72" onchange="updateFont()" />

      <label>‡¶≤‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶∞‡¶Ç:</label>
      <input type="color" id="fontColor" value="#000000" onchange="updateColor()" />

      <label>‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶°:</label>
      <input type="color" id="bgColor" value="#ffffff" onchange="updateBG()" />
      
      <div class="toolbar">
        <button onclick="toggleBold()" id="boldBtn">
          <span class="icon">ùêÅ</span> Bold
        </button>
        <button onclick="toggleItalic()" id="italicBtn">
          <span class="icon">ùêº</span> Italic
        </button>
        <button onclick="toggleUnderline()" id="underlineBtn">
          <span class="icon">ùëà</span> Underline
        </button>
      </div>
    </div>
    
    <div class="sidebar-section">
      <h3 class="section-title">‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶≠‡¶æ‡¶∏ ‡¶ü‡ßÅ‡¶≤‡¶∏</h3>
      <button onclick="toggleHandWriting()" id="handwritingBtn">
        <span class="icon">‚úçÔ∏è</span> ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶∞‡¶æ‡¶á‡¶ü‡¶ø‡¶Ç
      </button>
      <label>Brush Size:</label>
      <input type="number" id="brushSize" value="3" min="1" max="20" onchange="updateBrush()" />
      <button onclick="toggleEraser()" id="eraserBtn">
        <span class="icon">ü©π</span> Eraser
      </button>
      <div class="toolbar">
        <button onclick="undoDraw()">
          <span class="icon">‚Ü∂</span> Undo
        </button>
        <button onclick="redoDraw()">
          <span class="icon">‚Ü∑</span> Redo
        </button>
      </div>
      <label>‡¶õ‡¶¨‡¶ø ‡¶Ø‡ßã‡¶ó:</label>
      <input type="file" id="imgInput" accept="image/*" onchange="addImage(event)" />
    </div>
    
    <div class="sidebar-section">
      <h3 class="section-title">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
      <button onclick="toggleDarkMode()" id="darkModeBtn">
        <span class="icon">üåô</span> ‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶°
      </button>
      <button onclick="shareText()">
        <span class="icon">üì§</span> ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞
      </button>
    </div>
    
    <div class="sidebar-section">
      <h3 class="section-title">‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</h3>
      <p>‡¶Ü‡¶ñ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ: <span id="count">0</span></p>
    </div>
  </div>

  <div class="main-content" id="mainContent">
    <button class="menu-toggle" onclick="toggleMenu()">
      <span class="icon">‚ò∞</span> ‡¶Æ‡ßá‡¶®‡ßÅ
    </button>
    
    <div class="editor-container">
      <textarea id="editor" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." oninput="countChars()"></textarea>
      <div class="status-bar">
        <div id="charCount">‡¶Ü‡¶ñ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ: <span id="count">0</span></div>
        <div id="autoSaveStatus">‡¶Ö‡¶ü‡ßã ‡¶∏‡ßá‡¶≠: ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</div>
      </div>
    </div>
    
    <div class="canvas-container">
      <canvas id="canvas"></canvas>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// ===== Menu =====
let menuOpen = false;
const sideMenu = document.getElementById('sideMenu');
const mainContent = document.getElementById('mainContent');

function toggleMenu() {
  sideMenu.classList.toggle('collapsed');
  mainContent.classList.toggle('expanded');
  menuOpen = !menuOpen;
}

// ===== Text Editor =====
const editor = document.getElementById('editor');
const fontSelect = document.getElementById('fontSelect');
const fontSize = document.getElementById('fontSize');
const fontColor = document.getElementById('fontColor');
const bgColor = document.getElementById('bgColor');
const count = document.getElementById('count');
const boldBtn = document.getElementById('boldBtn');
const italicBtn = document.getElementById('italicBtn');
const underlineBtn = document.getElementById('underlineBtn');

function newFile() { 
  if (editor.value && !confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶∏‡ßá‡¶≠ ‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶π‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§')) {
    return;
  }
  editor.value = ""; 
  countChars(); 
  updateButtonStates();
}

function openFile(event) { 
  let reader = new FileReader(); 
  reader.onload = e => { 
    editor.value = e.target.result; 
    countChars(); 
  }; 
  reader.readAsText(event.target.files[0]); 
}

function saveFile() { 
  const blob = new Blob([editor.value], {type: "text/plain"}); 
  const a = document.createElement("a"); 
  a.href = URL.createObjectURL(blob); 
  a.download = "note.txt"; 
  a.click(); 
}

function updateFont() { 
  editor.style.fontFamily = fontSelect.value; 
  editor.style.fontSize = fontSize.value + "px"; 
}

function updateColor() { 
  editor.style.color = fontColor.value; 
}

function updateBG() { 
  editor.style.background = bgColor.value; 
}

function countChars() { 
  count.innerText = editor.value.length; 
}

// ===== Text Style =====
function toggleBold() { 
  editor.style.fontWeight = (editor.style.fontWeight === "bold") ? "normal" : "bold"; 
  updateButtonStates();
}

function toggleItalic() { 
  editor.style.fontStyle = (editor.style.fontStyle === "italic") ? "normal" : "italic"; 
  updateButtonStates();
}

function toggleUnderline() { 
  editor.style.textDecoration = (editor.style.textDecoration === "underline") ? "none" : "underline"; 
  updateButtonStates();
}

function updateButtonStates() {
  boldBtn.classList.toggle('active', editor.style.fontWeight === "bold");
  italicBtn.classList.toggle('active', editor.style.fontStyle === "italic");
  underlineBtn.classList.toggle('active', editor.style.textDecoration === "underline");
}

// ===== Auto-save =====
setInterval(() => { 
  localStorage.setItem('autosaveText', editor.value); 
}, 5000);

window.onload = () => { 
  if (localStorage.getItem('autosaveText')) {
    editor.value = localStorage.getItem('autosaveText'); 
  }
  countChars(); 
  updateButtonStates();
}

// ===== PDF =====
function downloadPDF() { 
  const { jsPDF } = window.jspdf; 
  const doc = new jsPDF(); 
  const text = editor.value; 
  const lines = doc.splitTextToSize(text, 180); 
  doc.text(lines, 10, 10); 
  doc.save("note.pdf"); 
}

// ===== Canvas =====
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const handwritingBtn = document.getElementById('handwritingBtn');
const eraserBtn = document.getElementById('eraserBtn');

// Set initial canvas size
function resizeCanvas() {
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
  // Redraw any existing content if needed
  if (undoStack.length > 0) {
    let img = new Image();
    img.onload = () => {
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    };
    img.src = undoStack[undoStack.length - 1];
  }
}

resizeCanvas();

let drawing = false;
let handwriting = false;
let brushColor = "#000000";
let brushSize = 3;
let eraserMode = false;
let undoStack = [];
let redoStack = [];

function toggleHandWriting() { 
  handwriting = !handwriting; 
  handwritingBtn.classList.toggle('active', handwriting);
  if (handwriting) {
    canvas.style.cursor = 'crosshair';
  } else {
    canvas.style.cursor = 'default';
  }
}

function updateBrush() { 
  brushSize = document.getElementById('brushSize').value; 
}

function toggleEraser() { 
  eraserMode = !eraserMode; 
  brushColor = eraserMode ? "#ffffff" : "#000000";
  eraserBtn.classList.toggle('active', eraserMode);
}

function saveState() { 
  undoStack.push(canvas.toDataURL()); 
  if (undoStack.length > 50) undoStack.shift(); 
  redoStack = []; // Clear redo stack when new action is performed
}

canvas.addEventListener("mousedown", e => { 
  if (!handwriting) return; 
  drawing = true; 
  saveState(); 
  ctx.beginPath(); 
  ctx.moveTo(e.offsetX, e.offsetY); 
});

canvas.addEventListener("mousemove", e => { 
  if (!drawing || !handwriting) return; 
  ctx.lineWidth = brushSize; 
  ctx.strokeStyle = brushColor; 
  ctx.lineTo(e.offsetX, e.offsetY); 
  ctx.stroke(); 
});

canvas.addEventListener("mouseup", () => drawing = false);
canvas.addEventListener("mouseout", () => drawing = false);

function undoDraw() { 
  if (!undoStack.length) return; 
  redoStack.push(canvas.toDataURL()); 
  let img = new Image(); 
  img.onload = () => { 
    ctx.clearRect(0, 0, canvas.width, canvas.height); 
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height); 
  }; 
  img.src = undoStack.pop(); 
}

function redoDraw() { 
  if (!redoStack.length) return; 
  undoStack.push(canvas.toDataURL()); 
  let img = new Image(); 
  img.onload = () => { 
    ctx.clearRect(0, 0, canvas.width, canvas.height); 
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height); 
  }; 
  img.src = redoStack.pop(); 
}

function addImage(event) { 
  let img = new Image(); 
  img.onload = () => {
    saveState();
    const maxWidth = canvas.width * 0.8;
    const maxHeight = canvas.height * 0.8;
    let width = img.width;
    let height = img.height;
    
    if (width > maxWidth) {
      height = (maxWidth / width) * height;
      width = maxWidth;
    }
    
    if (height > maxHeight) {
      width = (maxHeight / height) * width;
      height = maxHeight;
    }
    
    const x = (canvas.width - width) / 2;
    const y = (canvas.height - height) / 2;
    
    ctx.drawImage(img, x, y, width, height); 
  };
  img.src = URL.createObjectURL(event.target.files[0]); 
}

// ===== Dark Mode =====
const darkModeBtn = document.getElementById('darkModeBtn');
let darkMode = localStorage.getItem('darkMode') === 'true';

function toggleDarkMode() { 
  darkMode = !darkMode;
  document.body.classList.toggle('dark-mode', darkMode);
  localStorage.setItem('darkMode', darkMode);
  darkModeBtn.classList.toggle('active', darkMode);
  darkModeBtn.innerHTML = darkMode ? 
    '<span class="icon">‚òÄÔ∏è</span> ‡¶≤‡¶æ‡¶á‡¶ü ‡¶Æ‡ßã‡¶°' : 
    '<span class="icon">üåô</span> ‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶°';
}

// Initialize dark mode
if (darkMode) {
  document.body.classList.add('dark-mode');
  darkModeBtn.classList.add('active');
  darkModeBtn.innerHTML = '<span class="icon">‚òÄÔ∏è</span> ‡¶≤‡¶æ‡¶á‡¶ü ‡¶Æ‡ßã‡¶°';
}

// ===== Share =====
async function shareText() { 
  if (navigator.share) { 
    try { 
      await navigator.share({ 
        title: '‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡ßã‡¶ü',
        text: editor.value 
      }); 
    } catch(e) { 
      console.log("‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤"); 
    } 
  } else {
    // Fallback: copy to clipboard
    try {
      await navigator.clipboard.writeText(editor.value);
      alert('‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
    } catch (err) {
      alert("‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶®‡ßá‡¶á ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø");
    }
  } 
}

// ===== Responsive Canvas =====
window.addEventListener("resize", () => {
  resizeCanvas();
});
</script>
</body>
</html>
